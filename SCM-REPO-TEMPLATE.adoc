// SPDX-License-Identifier: AGPL-3.0-or-later
// SPDX-FileCopyrightText: 2025 Jonathan D.A. Jewell
= SCM Repository Template
:toc: left
:toclevels: 3
:icons: font
:sectnums:

Canonical directory structure and file requirements for all `.scm` format specification repositories.

== Overview

All repositories in the `.scm Format Family` (meta-scm, state-scm, ecosystem-scm, playbook-scm, agentic-scm, neurosym-scm, anchor-scm) MUST follow this template structure to ensure consistency, discoverability, and machine-readability.

== The 7 SCM Formats

[cols="1,2,3,2"]
|===
|Format |Repository |Purpose |Media Type

|**META.scm**
|hyperpolymath/meta-scm
|Architecture decisions, development practices
|`application/meta+scheme`

|**STATE.scm**
|(defined in meta-scm)
|Project state, milestones, session history
|`application/state+scheme`

|**ECOSYSTEM.scm**
|(defined in meta-scm)
|Ecosystem positioning, relationships
|`application/vnd.ecosystem+scm`

|**PLAYBOOK.scm**
|hyperpolymath/playbook-scm
|Executable plans, operational runbooks
|`application/playbook+scheme`

|**AGENTIC.scm**
|hyperpolymath/agentic-scm
|AI agent operational gating, safety controls
|`application/agentic+scheme`

|**NEUROSYM.scm**
|hyperpolymath/neurosym-scm
|Symbolic semantics, composition algebra
|`application/neurosym+scheme`

|**ANCHOR.scm**
|hyperpolymath/anchor-scm
|Project recalibration, scope intervention
|`application/anchor+scheme`
|===

== Directory Structure

Every SCM specification repository MUST have:

[source]
----
{format}-scm/
├── .claude/
│   └── CLAUDE.md              # AI assistant instructions
├── .github/
│   └── workflows/             # CI/CD workflows
├── .machine_readable/         # 6 SCM metadata files for THIS repo
│   ├── STATE.scm
│   ├── META.scm
│   ├── ECOSYSTEM.scm
│   ├── AGENTIC.scm
│   ├── NEUROSYM.scm
│   └── PLAYBOOK.scm
├── spec/                      # Formal specifications
│   ├── {FORMAT}-FORMAT-SPEC.adoc    # Primary specification (RFC-style)
│   ├── CONFORMANCE.adoc             # Compliance requirements
│   ├── VERSION-POLICY.adoc          # Version evolution rules
│   ├── IANA-MEDIA-TYPE.adoc         # Media type registration
│   ├── abnf/
│   │   └── {format}.abnf            # ABNF grammar
│   ├── schema/
│   │   └── {format}.schema.json     # JSON Schema (for tooling)
│   └── shared/                      # Shared with other SCM specs
│       ├── s-expression.abnf        # Common S-expression grammar
│       └── scm-common.schema.json   # Common JSON definitions
├── examples/                  # Reference implementations
│   ├── minimal.scm                  # Minimal valid file
│   └── comprehensive.scm            # Full-featured example
├── docs/                      # Additional documentation
│   ├── INTEGRATION.adoc             # How to use with other SCM formats
│   ├── TOOLING.adoc                 # Parser/validator info
│   └── FAQ.adoc                     # Common questions
├── README.adoc                # Overview and quick start
├── CONTRIBUTING.md            # Contribution guidelines
├── CONTRIBUTING.adoc          # Detailed contribution guide
├── SECURITY.md                # Security policy
├── CODE_OF_CONDUCT.md         # Community standards
├── LICENSE.txt                # AGPL-3.0-or-later
├── SATELLITES.scm             # List of satellite projects (if hub)
├── justfile                   # Build/test automation
└── Mustfile                   # Mandatory checks
----

== Required Files

=== README.adoc

MUST contain:

1. **Format Family Badge**: Link to .scm Format Family
2. **License Badges**: AGPL-3.0 + Palimpsest
3. **Purpose Statement**: One-line description of this format
4. **The .scm Format Family**: Table showing all 7 formats
5. **What is {FORMAT}.scm?**: Detailed explanation
6. **Why {FORMAT}.scm?**: Feature/benefit table
7. **Core Sections**: Document structure
8. **Getting Started**: Minimal example
9. **Specification Links**: Links to spec/ directory
10. **Examples**: Links to examples/
11. **Integration**: How it works with other SCM formats
12. **Standards Track**: IETF/IANA roadmap
13. **Media Type**: MIME type and extension

=== spec/{FORMAT}-FORMAT-SPEC.adoc

RFC-style specification MUST contain:

1. **Abstract**: Summary of the format
2. **Status of This Memo**: Document status
3. **Copyright Notice**: License
4. **Introduction**: Purpose and design goals
5. **Terminology**: RFC 2119/8174 key words
6. **File Structure**: Grammar overview
7. **Core Sections**: Required fields and semantics
8. **Extension Sections**: How to add custom sections
9. **Parsing Requirements**: Implementation guidance
10. **Security Considerations**: Security implications
11. **IANA Considerations**: Media type registration
12. **References**: Normative and informative

=== spec/abnf/{format}.abnf

ABNF grammar following RFC 5234:

[source,abnf]
----
; {FORMAT}.scm Grammar
; Based on shared/s-expression.abnf

{format}-file     = header-comments module-declaration sections

header-comments   = *comment
module-declaration = "(" "define-module" module-path export-clause ")"
sections          = *(define-section)

; Format-specific rules follow...
----

=== examples/minimal.scm

Minimal valid file demonstrating required structure:

[source,scheme]
----
;; SPDX-License-Identifier: MIT
;; SPDX-FileCopyrightText: 2025 Example Author

;;; {FORMAT}.scm — Minimal Example
;;; minimal-project

(define-module (minimal-project {format})
  #:export ({required-sections}))

(define {required-section-1}
  '(({minimal-example})))
----

== Relationship Hierarchy

[source]
----
                    ┌─────────────────────────────────────┐
                    │      hyperpolymath/standards        │
                    │      (Organization Hub)             │
                    └────────────────┬────────────────────┘
                                     │
        ┌────────────────────────────┼────────────────────────────┐
        │                            │                            │
        ▼                            ▼                            ▼
   ┌─────────┐                 ┌─────────┐                 ┌─────────┐
   │ meta-scm│                 │agentic- │                 │ anchor- │
   │(primary)│                 │  scm    │                 │   scm   │
   └────┬────┘                 └────┬────┘                 └────┬────┘
        │                           │                           │
   ┌────┴────┐                      │                           │
   │         │                      │                           │
   ▼         ▼                      ▼                           ▼
STATE.scm ECOSYSTEM.scm       PLAYBOOK.scm              (intervention
 (companion) (companion)       NEUROSYM.scm                 format)
                               (execution layer)
----

=== Execution Pipeline Order

All implementations MUST respect this order:

1. **META** validation (constitutional authority)
2. **AGENTIC** gating (operational safety)
3. **NEUROSYM** semantics (proof obligations)
4. **PLAYBOOK** derivation (executable plan)
5. **Execution**
6. **ECOSYSTEM** integrity check
7. **STATE** update

**ANCHOR.scm** is special: it can be dropped in at any time to trigger a recalibration, reviewing all 6 SCM files and realigning the project.

== Satellite Registration

All SCM specification repos MUST be registered in `hyperpolymath/standards/SATELLITES.scm`:

[source,scheme]
----
(satellites
  (version "1.0.0")
  (hub
    (name "standards")
    (url "https://github.com/hyperpolymath/standards")
    (description "Organization-wide standards and policies"))

  (satellite-repos
    ;; SCM Format Family
    (satellite
      (name "meta-scm")
      (url "https://github.com/hyperpolymath/meta-scm")
      (role "specification")
      (format-defines "META.scm STATE.scm ECOSYSTEM.scm")
      (description "META format specification and companions"))

    (satellite
      (name "playbook-scm")
      (url "https://github.com/hyperpolymath/playbook-scm")
      (role "specification")
      (format-defines "PLAYBOOK.scm")
      (description "Executable plan specification"))

    (satellite
      (name "agentic-scm")
      (url "https://github.com/hyperpolymath/agentic-scm")
      (role "specification")
      (format-defines "AGENTIC.scm")
      (description "AI agent operational gating specification"))

    (satellite
      (name "neurosym-scm")
      (url "https://github.com/hyperpolymath/neurosym-scm")
      (role "specification")
      (format-defines "NEUROSYM.scm")
      (description "Symbolic semantics specification"))

    (satellite
      (name "anchor-scm")
      (url "https://github.com/hyperpolymath/anchor-scm")
      (role "specification")
      (format-defines "ANCHOR.scm")
      (description "Project recalibration intervention format"))))
----

== Inter-Repository Connections

=== How Formats Reference Each Other

[source,scheme]
----
;; In STATE.scm - reference META for decisions
(define current-context
  '((active-meta-ref . "META.scm")
    (active-adrs . (adr-001 adr-003))
    (ecosystem-ref . "ECOSYSTEM.scm")))

;; In PLAYBOOK.scm - derived from META
(define derivation-source
  '((meta-rule . "adr-015")
    (state-context . "current-milestone")
    (agentic-gate . "entropy-budget-ok")))

;; In AGENTIC.scm - gates based on META authority
(define gating-policy
  '((authority-source . "META.scm")
    (override-path . "explicit-user-intent")
    (proof-requirement . "NEUROSYM.verified")))
----

== Versioning

All SCM specifications follow SemVer 2.0.0:

* **MAJOR**: Breaking changes to grammar or semantics
* **MINOR**: New optional features, backward compatible
* **PATCH**: Clarifications, examples, typos

Current versions:
|===
|Format |Version |Status

|META.scm |1.0.0-draft.1 |Community Specification
|STATE.scm |1.0.0-draft.1 |Companion to META
|ECOSYSTEM.scm |1.0.0-draft.1 |Companion to META
|PLAYBOOK.scm |0.1.0-draft.1 |Initial Development
|AGENTIC.scm |0.1.0-draft.1 |Initial Development
|NEUROSYM.scm |0.1.0-draft.1 |Initial Development
|ANCHOR.scm |0.1.0-draft.1 |Initial Development
|===

== License

All SCM specification repositories use:

* **License**: AGPL-3.0-or-later
* **Philosophy**: Palimpsest License overlay

SPDX headers REQUIRED on all source files.

