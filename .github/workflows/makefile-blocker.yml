# SPDX-License-Identifier: AGPL-3.0-or-later
name: Makefile Blocker

on:
  push:
    paths:
      - '**/Makefile'
      - '**/Makefile.*'
      - '**/*.mk'
  pull_request:
    paths:
      - '**/Makefile'
      - '**/Makefile.*'
      - '**/*.mk'

permissions: read-all

jobs:
  block-makefiles:
    name: Block Makefile Changes
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: Fail on Makefile presence
        run: |
          echo "::error::Makefiles are not permitted in Hyperpolymath repositories."
          echo ""
          echo "Use the Mustfile/justfile system instead:"
          echo "  - Mustfile: Mandatory checks (see hyperpolymath/mustfile)"
          echo "  - justfile: Build recipes (https://just.systems)"
          echo "  - mustfile.toml: Configuration"
          echo ""
          echo "Found Makefiles:"
          find . -name "Makefile" -o -name "Makefile.*" -o -name "*.mk" | grep -v ".github"
          echo ""
          echo "To migrate, see: https://github.com/hyperpolymath/mustfile"
          exit 1
