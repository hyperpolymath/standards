{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://scm-format.org/schema/v1.0/common.schema.json",
  "title": ".scm Format Family - Shared Definitions",
  "description": "Common JSON Schema definitions shared by all .scm format family members (META.scm, STATE.scm, etc.)",

  "$defs": {
    "isoDate": {
      "type": "string",
      "description": "ISO 8601 date (YYYY-MM-DD)",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$",
      "examples": ["2025-01-15", "2025-12-31"]
    },

    "isoDateTime": {
      "type": "string",
      "description": "ISO 8601 date-time with optional timezone",
      "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}(:[0-9]{2}(\\.[0-9]+)?)?(Z|[+-][0-9]{2}:[0-9]{2})?$",
      "examples": [
        "2025-01-15T10:30:00Z",
        "2025-01-15T10:30:00.123Z",
        "2025-01-15T10:30:00+05:30"
      ]
    },

    "semver": {
      "type": "string",
      "description": "Semantic Version 2.0.0 string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
      "examples": ["1.0.0", "2.1.0-beta.1", "0.9.0+build.123"]
    },

    "symbol": {
      "type": "string",
      "description": "Scheme symbol identifier",
      "pattern": "^[a-zA-Z!$%&*/:<=>?^_~][a-zA-Z0-9!$%&*/:<=>?^_~+.@-]*$",
      "examples": ["my-symbol", "adr-001", "session-abc123"]
    },

    "kebabCaseId": {
      "type": "string",
      "description": "Kebab-case identifier",
      "pattern": "^[a-z][a-z0-9]*(-[a-z0-9]+)*$",
      "examples": ["my-project", "user-authentication", "api-gateway"]
    },

    "modulePath": {
      "type": "string",
      "description": "Scheme module path in slash notation",
      "pattern": "^[a-z][a-z0-9-]*(/[a-z][a-z0-9-]*)*$",
      "examples": ["my-project/meta", "enterprise-api/state", "utils/common"]
    },

    "filePath": {
      "type": "string",
      "description": "File system path (relative or absolute)",
      "minLength": 1,
      "examples": ["/home/user/project", "./src/main.ts", "../lib/utils.js"]
    },

    "uri": {
      "type": "string",
      "description": "URI reference (RFC 3986)",
      "format": "uri",
      "examples": [
        "https://example.com/resource",
        "file:///home/user/file.txt",
        "git@github.com:user/repo.git"
      ]
    },

    "spdxLicense": {
      "type": "string",
      "description": "SPDX license identifier or expression",
      "pattern": "^[A-Za-z0-9.-]+(\\+)?( (AND|OR|WITH) [A-Za-z0-9.-]+(\\+)?)*$",
      "examples": ["MIT", "Apache-2.0", "GPL-3.0-or-later", "MIT AND Apache-2.0"]
    },

    "statusEnum": {
      "type": "string",
      "description": "Generic status enumeration base",
      "enum": ["pending", "active", "completed", "cancelled", "failed"]
    },

    "progressPercentage": {
      "type": "integer",
      "description": "Progress percentage (0-100)",
      "minimum": 0,
      "maximum": 100
    },

    "nonEmptyString": {
      "type": "string",
      "description": "Non-empty string value",
      "minLength": 1
    },

    "stringList": {
      "type": "array",
      "description": "List of non-empty strings",
      "items": {
        "$ref": "#/$defs/nonEmptyString"
      },
      "minItems": 0
    },

    "alistEntry": {
      "type": "object",
      "description": "Association list entry (key-value pair)",
      "minProperties": 1,
      "maxProperties": 1,
      "additionalProperties": true
    },

    "metadata": {
      "type": "object",
      "description": "Common metadata section",
      "properties": {
        "version": {
          "$ref": "#/$defs/semver",
          "description": "Format version"
        },
        "created": {
          "$ref": "#/$defs/isoDateTime",
          "description": "Creation timestamp"
        },
        "modified": {
          "$ref": "#/$defs/isoDateTime",
          "description": "Last modification timestamp"
        },
        "generator": {
          "type": "string",
          "description": "Tool that generated this file"
        }
      }
    },

    "projectReference": {
      "type": "object",
      "description": "Reference to a project",
      "required": ["name"],
      "properties": {
        "name": {
          "$ref": "#/$defs/kebabCaseId",
          "description": "Project identifier"
        },
        "path": {
          "$ref": "#/$defs/filePath",
          "description": "File system path to project"
        },
        "repository": {
          "$ref": "#/$defs/uri",
          "description": "Repository URL"
        },
        "meta-ref": {
          "type": "string",
          "description": "Path to project's META.scm file"
        }
      }
    },

    "userIdentity": {
      "type": "object",
      "description": "User identity information",
      "properties": {
        "name": {
          "type": "string",
          "description": "Display name"
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "Email address"
        },
        "handle": {
          "type": "string",
          "description": "Username or handle"
        }
      }
    },

    "toolReference": {
      "type": "object",
      "description": "Reference to a tool or dependency",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Tool name"
        },
        "version": {
          "type": "string",
          "description": "Tool version"
        },
        "command": {
          "type": "string",
          "description": "Command to invoke tool"
        }
      }
    },

    "tagList": {
      "type": "array",
      "description": "List of tags/labels",
      "items": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9-]*$"
      },
      "uniqueItems": true
    },

    "priority": {
      "type": "string",
      "description": "Priority level",
      "enum": ["critical", "high", "medium", "low", "none"]
    },

    "confidence": {
      "type": "number",
      "description": "Confidence score (0.0 to 1.0)",
      "minimum": 0,
      "maximum": 1
    },

    "durationSeconds": {
      "type": "integer",
      "description": "Duration in seconds",
      "minimum": 0
    },

    "byteSize": {
      "type": "integer",
      "description": "Size in bytes",
      "minimum": 0
    },

    "lineNumber": {
      "type": "integer",
      "description": "Line number (1-indexed)",
      "minimum": 1
    },

    "columnNumber": {
      "type": "integer",
      "description": "Column number (1-indexed)",
      "minimum": 1
    },

    "sourceLocation": {
      "type": "object",
      "description": "Location in source code",
      "required": ["file"],
      "properties": {
        "file": {
          "$ref": "#/$defs/filePath"
        },
        "line": {
          "$ref": "#/$defs/lineNumber"
        },
        "column": {
          "$ref": "#/$defs/columnNumber"
        },
        "function": {
          "type": "string",
          "description": "Function or method name"
        }
      }
    },

    "crossReference": {
      "type": "object",
      "description": "Cross-reference to another .scm file",
      "required": ["format", "path"],
      "properties": {
        "format": {
          "type": "string",
          "enum": ["meta", "state"],
          "description": "Target format type"
        },
        "path": {
          "$ref": "#/$defs/filePath",
          "description": "Path to referenced file"
        },
        "section": {
          "type": "string",
          "description": "Specific section in referenced file"
        },
        "id": {
          "type": "string",
          "description": "Specific entry ID (e.g., adr-001)"
        }
      }
    },

    "extensionSection": {
      "type": "object",
      "description": "Extension section for custom data",
      "additionalProperties": true
    }
  }
}
