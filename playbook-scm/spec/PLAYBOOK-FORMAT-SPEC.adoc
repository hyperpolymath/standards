// SPDX-License-Identifier: PMPL-1.0-or-later
// SPDX-FileCopyrightText: 2025 Jonathan D.A. Jewell
= PLAYBOOK Format Specification
:doctype: book
:toc: left
:toclevels: 4
:sectnums:
:source-highlighter: highlight.js
:icons: font

[.text-center]
*Internet-Draft Style Specification* +
*Version 0.1.0-draft.1* +
*January 2026*

== Abstract

This document specifies the PLAYBOOK.scm format, a Scheme-based syntax for
encoding executable plans and operational runbooks derived from META.scm
architectural decisions. PLAYBOOK files define *how* permitted actions are
executed within a system, operating under AGENTIC gating and producing
actions compatible with NEUROSYM semantics.

== Status of This Memo

This document specifies an experimental protocol for the Internet community.
This is a contribution to the RFC series, independently of any other RFC stream.
Discussion and suggestions for improvement are requested.

== Copyright Notice

Copyright (c) 2025-2026 Jonathan D.A. Jewell. AGPL-3.0-or-later.

== Introduction

=== Purpose

PLAYBOOK.scm addresses the need for machine-readable executable plans that:

1. **Derive from META** - Plans are consequences of architectural decisions
2. **Operate Under AGENTIC** - Execution is gated by operational safety
3. **Use NEUROSYM Semantics** - Actions have well-defined meanings
4. **Update STATE** - Successful execution updates project state

=== Design Goals

Derived Authority::
  PLAYBOOKs MUST NOT introduce new authority beyond META

Deterministic::
  Plans are derivable from META rules + validated user intent + STATE context

Gated Execution::
  All execution occurs after META validation and AGENTIC gating

Auditable::
  All executions and failures are recorded in journals

=== Relationship to Other Specifications

[cols="1,3"]
|===
|Specification |Relationship

|META.scm
|PLAYBOOK derives authority from META rules

|AGENTIC.scm
|PLAYBOOK execution is gated by AGENTIC

|NEUROSYM.scm
|PLAYBOOK actions use NEUROSYM semantics

|STATE.scm
|PLAYBOOK execution updates STATE on success
|===

== Terminology

=== Key Words

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in BCP 14 (RFC 2119, RFC 8174).

=== Definitions

PLAYBOOK File::
  A file with `.scm` extension (typically `PLAYBOOK.scm`) containing
  executable plans in the format specified by this document.

Procedure::
  A named sequence of steps that accomplish a task.

Step::
  An atomic action within a procedure.

Derivation Source::
  The META rules, STATE context, and user intent from which a PLAYBOOK is derived.

== File Structure

=== Overview

A PLAYBOOK file consists of:

1. **Header Comments** - License and file description
2. **Module Declaration** - Scheme module definition
3. **Derivation Declaration** - Source of authority
4. **Procedure Definitions** - Executable plans

=== Header Comments

PLAYBOOK files MUST begin with SPDX license headers:

[source,scheme]
----
;; SPDX-License-Identifier: PMPL-1.0-or-later
;; SPDX-FileCopyrightText: 2025 Example Author

;;; PLAYBOOK.scm â€” Operational Runbook
;;; project-name
----

=== Module Declaration

[source,scheme]
----
(define-module (project-name playbook)
  #:export (derivation-source
            procedures
            alerts
            contacts))
----

=== Derivation Declaration

Every PLAYBOOK MUST declare its derivation source:

[source,scheme]
----
(define derivation-source
  '((type . "derived")           ; or "non-derived" if explicitly permitted
    (meta-rules . (adr-001 adr-015))
    (state-context . "current-milestone")
    (agentic-gate . "entropy-budget-ok")
    (user-intent . "build-and-deploy")
    (timestamp . "2026-01-03T12:00:00Z")))
----

== Core Sections

=== Procedures (`procedures`)

==== Purpose

Defines executable plans as named procedures with ordered steps.

==== Structure

[source,scheme]
----
(define procedures
  '((build
     (description . "Build the project")
     (preconditions . ("src/ exists" "deps installed"))
     (steps
       ((step 1) (action . "deno task build") (timeout . 300))
       ((step 2) (action . "deno task test") (timeout . 600))
       ((step 3) (action . "validate-output") (timeout . 60)))
     (postconditions . ("dist/ created" "tests pass"))
     (on-failure . "rollback"))

    (deploy
     (description . "Deploy to production")
     (preconditions . ("build successful" "agentic-gate-passed"))
     (requires-confirmation . #t)
     (steps
       ((step 1) (action . "backup-current"))
       ((step 2) (action . "push-to-prod"))
       ((step 3) (action . "verify-deployment")))
     (on-failure . "rollback-and-alert"))))
----

==== Required Fields

* `description` - Human-readable purpose
* `steps` - Ordered list of actions
* `on-failure` - Failure handling strategy

==== Optional Fields

* `preconditions` - Conditions that MUST be true before execution
* `postconditions` - Conditions that MUST be true after success
* `timeout` - Maximum execution time per step (seconds)
* `requires-confirmation` - Explicit user confirmation required

=== Alerts (`alerts`)

[source,scheme]
----
(define alerts
  '((build-failure
     (severity . "high")
     (channel . "slack")
     (message . "Build failed: {{error}}")
     (escalation . 300))

    (deploy-failure
     (severity . "critical")
     (channel . ("slack" "pager"))
     (message . "Deployment failed: {{error}}")
     (escalation . 0))))
----

=== Contacts (`contacts`)

[source,scheme]
----
(define contacts
  '((on-call
     (name . "Operations Team")
     (channel . "ops-oncall@example.com")
     (hours . "24/7"))

    (escalation
     (name . "Engineering Lead")
     (channel . "eng-lead@example.com")
     (hours . "business-hours"))))
----

== Execution Constraints

=== Pipeline Position

PLAYBOOK execution:

1. MUST occur after META validation
2. MUST occur after AGENTIC gating
3. MUST occur after NEUROSYM proof discharge (where applicable)
4. MUST occur before ECOSYSTEM integrity checks
5. MUST NOT directly update STATE (STATE updates follow successful execution)

=== Derivation Rules

By default, a PLAYBOOK MUST be deterministically derivable from:

* META rules (architectural decisions)
* Validated user intent (explicit present request)
* Current STATE context (project phase, milestones)

A PLAYBOOK MAY declare itself non-derived ONLY if:

* META explicitly permits this class of non-derived plans
* The PLAYBOOK declares its authority source explicitly

=== Failure Modes

If PLAYBOOK execution fails:

* The system MUST rollback or branch
* STATE MUST NOT be committed
* The failure MUST be recorded in the journal
* Alerts MUST be triggered according to severity

== Security Considerations

=== No New Authority

PLAYBOOKs MUST NOT introduce authority beyond what META grants.

=== Gated Execution

All PLAYBOOK steps are subject to AGENTIC gating.

=== Audit Trail

All executions and failures MUST be logged.

== IANA Considerations

=== Media Type Registration

* **Type name**: application
* **Subtype name**: playbook+scheme
* **Required parameters**: None
* **Optional parameters**: charset (default UTF-8), version
* **Encoding considerations**: UTF-8 text
* **Security considerations**: See Security Considerations section
* **Interoperability considerations**: Compatible with .scm Format Family
* **Published specification**: This document
* **Applications that use this media type**: AI agents, CI/CD systems, runbook tools

== Conformance

An implementation is PLAYBOOK-conformant if:

* All PLAYBOOKs are either derived or explicitly permitted by META
* No PLAYBOOK bypasses META or AGENTIC
* Execution ordering is preserved
* Failures are properly recorded and handled

== References

=== Normative References

* RFC 2119 - Key words for use in RFCs
* RFC 8174 - Ambiguity of Uppercase vs Lowercase in RFC 2119
* META.scm Specification
* AGENTIC.scm Specification
* NEUROSYM.scm Specification

=== Informative References

* SemVer 2.0.0 - Semantic Versioning
* RFC 5234 - ABNF Notation

