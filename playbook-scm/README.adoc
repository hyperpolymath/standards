// SPDX-License-Identifier: PMPL-1.0-or-later
// SPDX-FileCopyrightText: 2025 Jonathan D.A. Jewell
= PLAYBOOK.scm

image:https://img.shields.io/badge/License-PMPL--1.0-blue.svg[License: PMPL-1.0,link="https://github.com/hyperpolymath/palimpsest-license"]
image:https://img.shields.io/badge/Philosophy-Palimpsest-indigo.svg[Palimpsest,link="https://github.com/hyperpolymath/palimpsest-license"]
image:https://img.shields.io/badge/SCM_Family-execution-green.svg[SCM Family]
:toc: left
:toclevels: 2
:icons: font

Machine-readable executable plans and operational runbooks.

Part of the **.scm Format Family** — Scheme S-expression data formats for
software engineering workflows.

== The .scm Format Family

[cols="1,2,2,1"]
|===
|Format |Purpose |Repository |Tier

|**META.scm**
|Architecture decisions, governance
|hyperpolymath/meta-scm
|Primary

|**STATE.scm**
|Project state, milestones
|(companion to META)
|Primary

|**ECOSYSTEM.scm**
|Ecosystem positioning
|(companion to META)
|Primary

|**PLAYBOOK.scm**
|Executable plans, runbooks
|hyperpolymath/playbook-scm
|Execution

|**AGENTIC.scm**
|AI agent gating, safety
|hyperpolymath/agentic-scm
|Execution

|**NEUROSYM.scm**
|Symbolic semantics
|hyperpolymath/neurosym-scm
|Execution

|**ANCHOR.scm**
|Project recalibration
|hyperpolymath/anchor-scm
|Intervention
|===

== What is PLAYBOOK.scm?

PLAYBOOK.scm defines *how* permitted actions are executed, not *whether* they
are permitted (that's META) or *whether* they may proceed now (that's AGENTIC).

PLAYBOOKs are **derived** from:

* META rules (architectural decisions)
* STATE context (current project phase)
* Validated user intent (explicit present request)

[source,scheme]
----
;; SPDX-License-Identifier: PMPL-1.0-or-later

(define-module (my-project playbook)
  #:export (derivation-source procedures alerts contacts))

(define derivation-source
  '((type . "derived")
    (meta-rules . (adr-001 adr-015))
    (state-context . "beta-phase")
    (timestamp . "2026-01-03T12:00:00Z")))

(define procedures
  '((build
     (description . "Build the project")
     (steps
       ((step 1) (action . "deno task build") (timeout . 300))
       ((step 2) (action . "deno task test") (timeout . 600)))
     (on-failure . "abort-and-notify"))

    (deploy
     (description . "Deploy to production")
     (requires-confirmation . #t)
     (steps
       ((step 1) (action . "backup-current"))
       ((step 2) (action . "push-to-prod"))
       ((step 3) (action . "verify-deployment")))
     (on-failure . "rollback-and-alert"))))
----

== Why PLAYBOOK.scm?

[cols="1,3"]
|===
|Feature |Benefit

|*Derived Authority*
|Plans inherit authority from META, cannot introduce new permissions

|*Gated Execution*
|All execution is subject to AGENTIC safety controls

|*Auditable*
|All executions and failures are recorded in journals

|*Machine-Readable*
|Tooling can parse, validate, and execute plans

|*Rollback-Aware*
|Failure handling and rollback strategies built-in

|*Cross-Format*
|Integrates with META, STATE, AGENTIC, NEUROSYM
|===

== Execution Pipeline

PLAYBOOKs execute within a defined order:

[source]
----
1. META validation      → Constitutional authority check
2. AGENTIC gating       → Operational safety check
3. NEUROSYM semantics   → Proof obligations discharge
4. PLAYBOOK derivation  → Build executable plan
5. Execution            → Run the plan
6. ECOSYSTEM check      → Integrity verification
7. STATE update         → Record success/failure
----

== Core Sections

=== Derivation Source (`derivation-source`)

Declares where the PLAYBOOK's authority comes from:

* `type` - "derived" (default) or "non-derived" (if META permits)
* `meta-rules` - Which ADRs authorize this PLAYBOOK
* `state-context` - Current project phase
* `agentic-gate` - AGENTIC status at derivation time

=== Procedures (`procedures`)

Executable plans with:

* `description` - Human-readable purpose
* `preconditions` - Required state before execution
* `steps` - Ordered actions with timeouts
* `postconditions` - Expected state after success
* `on-failure` - Failure handling strategy

=== Alerts (`alerts`)

Notification configuration:

* Severity levels (info, medium, high, critical)
* Channels (slack, pager, email)
* Escalation delays

=== Contacts (`contacts`)

On-call and escalation contacts.

== Getting Started

=== Create a PLAYBOOK.scm File

[source,scheme]
----
;; SPDX-License-Identifier: PMPL-1.0-or-later
;; SPDX-FileCopyrightText: 2025 Your Name

;;; PLAYBOOK.scm — Operational Runbook
;;; your-project

(define-module (your-project playbook)
  #:export (derivation-source procedures))

(define derivation-source
  '((type . "derived")
    (meta-rules . (adr-001))
    (timestamp . "2026-01-03T00:00:00Z")))

(define procedures
  '((build
     (description . "Build the project")
     (steps
       ((step 1) (action . "deno task build")))
     (on-failure . "abort"))))
----

== Specification

The formal specification is in the `spec/` directory:

* link:spec/PLAYBOOK-FORMAT-SPEC.adoc[PLAYBOOK-FORMAT-SPEC.adoc] - Complete specification

== Examples

See the link:examples/[examples/] directory:

* link:examples/minimal.scm[minimal.scm] - Minimal valid PLAYBOOK
* link:examples/comprehensive.scm[comprehensive.scm] - Full-featured example

== Conformance Requirements

A PLAYBOOK is conformant if:

1. It is derived from META (or explicitly permitted as non-derived)
2. It does not bypass META or AGENTIC
3. Execution ordering is preserved
4. Failures are properly recorded

== Media Type

* **MIME Type**: `application/playbook+scheme`
* **File Extension**: `.scm` (conventionally `PLAYBOOK.scm`)
* **Encoding**: UTF-8

== Failure Modes

If PLAYBOOK execution fails:

* The system MUST rollback or branch
* STATE MUST NOT be committed
* The failure MUST be recorded in the journal
* Alerts MUST be triggered

== Related Specifications

* link:https://github.com/hyperpolymath/meta-scm[META.scm] - Architecture decisions
* link:https://github.com/hyperpolymath/agentic-scm[AGENTIC.scm] - Operational gating
* link:https://github.com/hyperpolymath/neurosym-scm[NEUROSYM.scm] - Symbolic semantics

== License

PMPL-1.0-or-later with Palimpsest philosophical overlay.

