# Nginx configuration for Palimpsest License
# Add this to your server block to inject license headers

# Example server block
server {
    listen 80;
    server_name example.com;
    root /var/www/html;

    # Palimpsest License Headers
    # Add these headers to all responses
    add_header X-License "Palimpsest-0.4" always;
    add_header X-License-Url "https://palimpsestlicense.org/v0.4" always;
    add_header X-Palimpsest-Version "0.4" always;
    add_header X-Palimpsest-AGI-Consent "true" always;
    add_header Link "<https://palimpsestlicense.org/v0.4>; rel=\"license\"" always;

    # Optional: Add author information
    add_header X-Author "Your Name" always;

    # License information endpoint
    location = /license.json {
        default_type application/json;
        return 200 '{
            "license": {
                "name": "Palimpsest License v0.4",
                "version": "0.4",
                "url": "https://palimpsestlicense.org/v0.4",
                "identifier": "Palimpsest-0.4"
            },
            "work": {
                "title": "My Work",
                "author": "Your Name"
            },
            "protections": {
                "agi_consent_required": true,
                "metadata_preservation_required": true,
                "quantum_proof_traceability": true
            }
        }';
    }

    # Static files with license headers
    location ~* \.(html|css|js|json)$ {
        # Inherit headers from server block
        expires 1h;
        add_header Cache-Control "public, must-revalidate";
    }

    # Proxy to application server (optional)
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# Alternative: Location-specific license
# Use this if different parts of your site have different licenses
server {
    listen 80;
    server_name multi-license.example.com;
    root /var/www/html;

    # Default license for most content
    add_header X-License "Palimpsest-0.4" always;
    add_header X-License-Url "https://palimpsestlicense.org/v0.4" always;

    # Different license for /api
    location /api {
        add_header X-License "MIT" always;
        add_header X-License-Url "https://opensource.org/licenses/MIT" always;
        proxy_pass http://localhost:3000;
    }

    # Palimpsest-licensed creative content
    location /stories {
        add_header X-License "Palimpsest-0.4" always;
        add_header X-License-Url "https://palimpsestlicense.org/v0.4" always;
        add_header X-Palimpsest-AGI-Consent "true" always;
        add_header X-Author "Story Author" always;
    }
}
