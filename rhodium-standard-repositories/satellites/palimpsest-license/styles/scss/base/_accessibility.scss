// base/_accessibility.scss
// WCAG 2.3 compliant accessibility styles for Palimpsest License

@use '../variables' as *;
@use '../mixins' as *;

// ============================================================================
// Screen Reader Only Utility
// ============================================================================

.sr-only {
  @include sr-only;

  &:not(:focus):not(:active) {
    @include sr-only;
  }
}

// Focusable screen reader only elements
.sr-only-focusable {
  @include sr-only;
  @include sr-only-focusable;
}

// ============================================================================
// Skip Links
// ============================================================================

.skip-link {
  @include sr-only;
  position: fixed;
  top: $spacing-sm;
  left: $spacing-sm;
  z-index: $z-index-tooltip;
  padding: $spacing-sm $spacing-md;
  background-color: var(--colour-background);
  color: var(--colour-text);
  text-decoration: none;
  border: $border-width-medium solid var(--colour-accent);
  border-radius: $border-radius-md;

  &:focus {
    position: fixed;
    width: auto;
    height: auto;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
}

// ============================================================================
// Reduced Motion Support
// ============================================================================

@include reduced-motion {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

// ============================================================================
// High Contrast Mode
// ============================================================================

@include high-contrast {
  :root {
    forced-color-adjust: auto;
  }

  a {
    color: LinkText;

    &:visited {
      color: VisitedText;
    }

    &:active {
      color: ActiveText;
    }
  }

  button {
    border: $border-width-medium solid ButtonBorder;
  }

  :focus {
    outline: $focus-outline-width solid Highlight;
    outline-offset: $focus-outline-offset;
  }
}

// ============================================================================
// Reduced Transparency
// ============================================================================

@include reduced-transparency {
  body {
    background-color: $colour-background-light;
    color: $colour-text-light;
  }

  @include dark-mode {
    body {
      background-color: $colour-background-dark;
      color: $colour-text-dark;
    }
  }
}

// ============================================================================
// Focus Indicators
// ============================================================================

// Enhanced focus for keyboard navigation
.focus-enhanced:focus-visible,
[data-focus-enhanced]:focus-visible {
  outline: $focus-outline-width solid var(--colour-accent);
  outline-offset: $focus-outline-offset + 2px;
  box-shadow: 0 0 0 4px colour-opacity(var(--colour-accent), 0.2);
}

// Focus within - highlight parent when child is focused
.focus-within:focus-within {
  outline: $border-width-thin solid var(--colour-accent);
  outline-offset: 2px;
}

// ============================================================================
// Touch Target Sizing
// ============================================================================

// Ensure minimum touch target size (44x44px for WCAG)
.touch-target,
button,
a,
input[type="checkbox"],
input[type="radio"],
select {
  @include touch-target;
}

// ============================================================================
// Text Sizing
// ============================================================================

// Prevent text size adjustment issues
body,
p,
li,
td,
th {
  text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  -moz-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
}

// ============================================================================
// Keyboard Navigation
// ============================================================================

// Visible keyboard focus for all interactive elements
a,
button,
input,
select,
textarea,
[tabindex]:not([tabindex="-1"]) {
  @include focus-visible;
}

// Remove focus outline for mouse users, keep for keyboard users
:focus:not(:focus-visible) {
  outline: none;
}

// ============================================================================
// ARIA Live Regions
// ============================================================================

[aria-live] {
  // Polite announcements
  &[aria-live="polite"] {
    position: relative;
  }

  // Assertive announcements
  &[aria-live="assertive"] {
    position: relative;
  }
}

// ============================================================================
// Language Support
// ============================================================================

// Support for right-to-left languages
[dir="rtl"] {
  direction: rtl;
  text-align: right;
}

[dir="ltr"] {
  direction: ltr;
  text-align: left;
}

// Language-specific styling
:lang(nl) {
  // Dutch-specific adjustments if needed
  hyphens: auto;
}

:lang(en) {
  // English-specific adjustments if needed
  hyphens: auto;
}

// ============================================================================
// Print Accessibility
// ============================================================================

@include print-styles {
  body {
    background-color: white !important;
    color: black !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  // Show link URLs in print
  a[href]::after {
    content: " (" attr(href) ")";
    font-size: 0.8em;
    color: #666;
    word-break: break-all;
  }

  // Don't show URLs for anchor links
  a[href^="#"]::after,
  a[href^="javascript:"]::after {
    content: "";
  }

  // Ensure page breaks
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
    page-break-inside: avoid;
  }

  table,
  figure,
  img {
    page-break-inside: avoid;
  }

  // Hide non-essential elements
  .no-print,
  .skip-link,
  nav:not(.print-nav) {
    display: none !important;
  }
}

// ============================================================================
// Braille Display Support
// ============================================================================

// Optimize for Braille displays
@media (prefers-reduced-motion: reduce) and (prefers-contrast: more) {
  body {
    // Enhance text rendering for Braille
    text-rendering: optimizeLegibility;
    font-size: calc(#{$font-size-base} * #{$braille-scale});
  }
}

// ============================================================================
// Contrast Enhancements
// ============================================================================

@media (prefers-contrast: more) {
  :root {
    --colour-accent: #{$colour-accent-light};
    --colour-border: #{$colour-text-light};
  }

  @include dark-mode {
    :root {
      --colour-accent: #{$colour-accent-dark};
      --colour-border: #{$colour-text-dark};
    }
  }

  // Increase border visibility
  *[class*="border"] {
    border-width: $border-width-medium;
  }

  // Enhance focus indicators
  :focus-visible {
    outline-width: $focus-outline-width + 1px;
    outline-offset: $focus-outline-offset + 1px;
  }
}

// ============================================================================
// WCAG Compliance Utilities
// ============================================================================

// High contrast text
.text-high-contrast {
  color: var(--colour-text);
  background-color: var(--colour-background);
  padding: $spacing-xs;
}

// Accessible hiding (for decorative elements)
.decorative {
  aria-hidden: true;
  pointer-events: none;
}

// Announce changes to screen readers
.announce-change {
  &[aria-live="polite"] {
    position: relative;
  }
}
