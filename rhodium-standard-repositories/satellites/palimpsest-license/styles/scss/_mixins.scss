// _mixins.scss
// Reusable mixins and patterns for Palimpsest License styling system

@use 'sass:string';
@use 'variables' as *;

// ============================================================================
// Responsive Design Mixins
// ============================================================================

// Media query breakpoints
@mixin breakpoint-up($breakpoint) {
  @if $breakpoint == xs {
    @media (min-width: $breakpoint-xs) { @content; }
  } @else if $breakpoint == sm {
    @media (min-width: $breakpoint-sm) { @content; }
  } @else if $breakpoint == md {
    @media (min-width: $breakpoint-md) { @content; }
  } @else if $breakpoint == lg {
    @media (min-width: $breakpoint-lg) { @content; }
  } @else if $breakpoint == xl {
    @media (min-width: $breakpoint-xl) { @content; }
  } @else if $breakpoint == 2xl {
    @media (min-width: $breakpoint-2xl) { @content; }
  } @else {
    @media (min-width: $breakpoint) { @content; }
  }
}

@mixin breakpoint-down($breakpoint) {
  @if $breakpoint == xs {
    @media (max-width: $breakpoint-xs - 1) { @content; }
  } @else if $breakpoint == sm {
    @media (max-width: $breakpoint-sm - 1) { @content; }
  } @else if $breakpoint == md {
    @media (max-width: $breakpoint-md - 1) { @content; }
  } @else if $breakpoint == lg {
    @media (max-width: $breakpoint-lg - 1) { @content; }
  } @else if $breakpoint == xl {
    @media (max-width: $breakpoint-xl - 1) { @content; }
  } @else if $breakpoint == 2xl {
    @media (max-width: $breakpoint-2xl - 1) { @content; }
  } @else {
    @media (max-width: $breakpoint - 1) { @content; }
  }
}

@mixin breakpoint-between($min, $max) {
  @media (min-width: $min) and (max-width: $max - 1) { @content; }
}

// ============================================================================
// Accessibility Mixins
// ============================================================================

// Screen reader only content
@mixin sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

// Reverse sr-only
@mixin sr-only-focusable {
  &:active,
  &:focus {
    position: static;
    width: auto;
    height: auto;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
}

// Accessible focus styles
@mixin focus-visible {
  &:focus-visible {
    outline: var(--focus-outline);
    outline-offset: var(--focus-outline-offset);
  }

  &:focus:not(:focus-visible) {
    outline: none;
  }
}

// Accessible touch target
@mixin touch-target($size: $min-touch-target) {
  position: relative;

  &::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    min-width: $size;
    min-height: $size;
  }
}

// ============================================================================
// Typography Mixins
// ============================================================================

// Fluid typography
@mixin fluid-type($min-size, $max-size, $min-width: $breakpoint-sm, $max-width: $breakpoint-xl) {
  font-size: calc(#{$min-size} + (#{strip-unit($max-size)} - #{strip-unit($min-size)}) * ((100vw - #{$min-width}) / (#{strip-unit($max-width)} - #{strip-unit($min-width)})));

  @media (max-width: $min-width) {
    font-size: $min-size;
  }

  @media (min-width: $max-width) {
    font-size: $max-size;
  }
}

// Truncate text with ellipsis
@mixin truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

// Multi-line truncate
@mixin line-clamp($lines) {
  display: -webkit-box;
  -webkit-line-clamp: $lines;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

// ============================================================================
// Layout Mixins
// ============================================================================

// Flexbox utilities
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

@mixin flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

// Grid utilities
@mixin grid-auto($min-width, $gap: $spacing-md) {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax($min-width, 1fr));
  gap: $gap;
}

// Container
@mixin container($max-width: $max-width-lg, $padding: $container-padding) {
  max-width: $max-width;
  margin-left: auto;
  margin-right: auto;
  padding-left: $padding;
  padding-right: $padding;

  @include breakpoint-down(md) {
    padding-left: $container-padding-mobile;
    padding-right: $container-padding-mobile;
  }
}

// ============================================================================
// Visual Effects Mixins
// ============================================================================

// Card style
@mixin card($padding: $spacing-lg) {
  padding: $padding;
  background-color: var(--colour-surface);
  border: $border-width-thin solid var(--colour-border);
  border-radius: $border-radius-md;
  box-shadow: $shadow-sm;
}

// Hover lift effect
@mixin hover-lift {
  transition: transform $transition-speed-normal $transition-easing-default,
              box-shadow $transition-speed-normal $transition-easing-default;

  @media (prefers-reduced-motion: no-preference) {
    &:hover {
      transform: translateY(-2px);
      box-shadow: $shadow-lg;
    }
  }
}

// Smooth gradient
@mixin gradient($start-colour, $end-colour, $direction: to bottom) {
  background: linear-gradient($direction, $start-colour, $end-colour);
}

// ============================================================================
// Animation Mixins
// ============================================================================

// Fade in animation
@mixin fade-in($duration: $transition-speed-normal) {
  @media (prefers-reduced-motion: no-preference) {
    animation: fadeIn $duration $transition-easing-default;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

// Slide in animation
@mixin slide-in($direction: bottom, $duration: $transition-speed-normal) {
  @media (prefers-reduced-motion: no-preference) {
    animation: slideIn#{capitalize($direction)} $duration $transition-easing-default;
  }
}

@keyframes slideInBottom {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes slideInTop {
  from {
    transform: translateY(-20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

// Pulse animation
@mixin pulse($duration: 2s) {
  @media (prefers-reduced-motion: no-preference) {
    animation: pulse $duration infinite;
  }
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

// ============================================================================
// Theme Mixins
// ============================================================================

// Light mode styles
@mixin light-mode {
  @media (prefers-color-scheme: light) {
    @content;
  }
}

// Dark mode styles
@mixin dark-mode {
  @media (prefers-color-scheme: dark) {
    @content;
  }
}

// High contrast mode
@mixin high-contrast {
  @media (forced-colors: active) {
    @content;
  }
}

// Reduced motion preference
@mixin reduced-motion {
  @media (prefers-reduced-motion: reduce) {
    @content;
  }
}

// Reduced transparency preference
@mixin reduced-transparency {
  @media (prefers-reduced-transparency: reduce) {
    @content;
  }
}

// ============================================================================
// Print Mixins
// ============================================================================

@mixin print-styles {
  @media print {
    @content;
  }
}

@mixin print-hidden {
  @media print {
    display: none !important;
  }
}

@mixin print-visible {
  display: none;

  @media print {
    display: block !important;
  }
}

// ============================================================================
// Utility Mixins
// ============================================================================

// Clear floats
@mixin clearfix {
  &::after {
    content: '';
    display: table;
    clear: both;
  }
}

// Aspect ratio
@mixin aspect-ratio($width, $height) {
  aspect-ratio: $width / $height;

  // Fallback for older browsers
  @supports not (aspect-ratio: 1 / 1) {
    &::before {
      content: '';
      float: left;
      padding-top: calc($height / $width * 100%);
    }

    &::after {
      content: '';
      display: table;
      clear: both;
    }
  }
}

// Reset list styles
@mixin list-unstyled {
  list-style: none;
  padding-left: 0;
  margin: 0;
}

// Reset button styles
@mixin button-reset {
  background: none;
  border: none;
  padding: 0;
  margin: 0;
  font: inherit;
  color: inherit;
  cursor: pointer;

  &:focus {
    @include focus-visible;
  }
}

// Helper function to strip units
@function strip-unit($value) {
  @return $value / ($value * 0 + 1);
}

// Helper function to capitalise
@function capitalize($str) {
  @return string.to-upper-case(string.slice($str, 1, 1)) + string.slice($str, 2);
}
