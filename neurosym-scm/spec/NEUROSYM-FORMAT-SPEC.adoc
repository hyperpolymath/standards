// SPDX-License-Identifier: MPL-2.0-or-later
// SPDX-FileCopyrightText: 2025 Jonathan D.A. Jewell
= NEUROSYM Format Specification
:doctype: book
:toc: left
:toclevels: 4
:sectnums:
:source-highlighter: highlight.js
:icons: font

[.text-center]
*Internet-Draft Style Specification* +
*Version 0.1.0-draft.1* +
*January 2026*

== Abstract

This document specifies the NEUROSYM.scm format, a Scheme-based syntax for
encoding symbolic semantics and algebraic properties of operations. NEUROSYM
files define *meaning* - composition rules, inversion semantics, and proof
obligations - separate from permission (META) or operational gating (AGENTIC).

== Status of This Memo

This document specifies an experimental protocol for the Internet community.
This is a contribution to the RFC series, independently of any other RFC stream.
Discussion and suggestions for improvement are requested.

== Copyright Notice

Copyright (c) 2025-2026 Jonathan D.A. Jewell. AGPL-3.0-or-later.

== Introduction

=== Purpose

NEUROSYM.scm addresses the need for machine-readable semantic definitions that:

1. **Define Meaning** - Specify what operations mean, not whether they're allowed
2. **Enable Composition** - Rules for combining operations safely
3. **Surface Proofs** - Expose proof obligations for claimed properties
4. **Support Verification** - Hooks for STATE/ECOSYSTEM integrity checks

=== Design Goals

Deterministic::
  NEUROSYM semantics MUST be deterministic and unambiguous

Separate from Policy::
  Semantic truth is distinct from policy permission

Proof-Aware::
  All claims expose proof obligations (verified vs unverified)

Fail-Safe::
  Undischarged proofs downgrade claims, never silently preserve them

=== Relationship to Other Specifications

[cols="1,3"]
|===
|Specification |Relationship

|META.scm
|NEUROSYM is subordinate to META, defines meaning within META constraints

|AGENTIC.scm
|AGENTIC uses NEUROSYM proof outcomes as truth predicates

|PLAYBOOK.scm
|PLAYBOOK operations have NEUROSYM-defined semantics

|STATE.scm
|STATE uses NEUROSYM verification hooks for integrity checks
|===

== Terminology

=== Key Words

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in BCP 14 (RFC 2119, RFC 8174).

=== Definitions

NEUROSYM File::
  A file with `.scm` extension (typically `NEUROSYM.scm`) containing
  symbolic semantics in the format specified by this document.

Operation::
  A named action with defined forward semantics and optionally inverse semantics.

Composition::
  Combining multiple operations into a larger operation with derived properties.

Proof Obligation::
  A condition that must be discharged to make a claim verified.

Claim Type::
  Classification of operation outcome: verified, unverified, or irreversible.

== File Structure

=== Overview

A NEUROSYM file consists of:

1. **Header Comments** - License and file description
2. **Module Declaration** - Scheme module definition
3. **Operation Definitions** - Semantic specifications
4. **Composition Rules** - How operations combine
5. **Proof Surfaces** - Verification interfaces

=== Header Comments

NEUROSYM files MUST begin with SPDX license headers:

[source,scheme]
----
;; SPDX-License-Identifier: MPL-2.0-or-later
;; SPDX-FileCopyrightText: 2025 Example Author

;;; NEUROSYM.scm — Symbolic Semantics
;;; project-name
----

=== Module Declaration

[source,scheme]
----
(define-module (project-name neurosym)
  #:export (operation-definitions
            composition-rules
            proof-obligations
            type-system))
----

== Core Sections

=== Operation Definitions (`operation-definitions`)

==== Purpose

Defines the semantic meaning of operations.

==== Structure

[source,scheme]
----
(define operation-definitions
  '((file-read
     (forward-semantics . "Return file contents as byte sequence")
     (inverse . #f)
     (claim-type . "verified")
     (entropy-contribution . 1)
     (preconditions . ("file-exists" "read-permission"))
     (postconditions . ("content-unchanged")))

    (file-write
     (forward-semantics . "Replace file contents with new byte sequence")
     (inverse . "file-write-with-original")
     (claim-type . "compensable")
     (entropy-contribution . 5)
     (preconditions . ("write-permission" "valid-content"))
     (postconditions . ("content-matches-input")))

    (file-delete
     (forward-semantics . "Remove file from filesystem")
     (inverse . #f)
     (claim-type . "irreversible")
     (entropy-contribution . 20)
     (preconditions . ("delete-permission" "file-exists"))
     (postconditions . ("file-not-exists")))))
----

==== Claim Types

* `verified` - Operation outcome can be proven correct
* `unverified` - Outcome claimed but not proven
* `compensable` - Can be undone via compensating action
* `irreversible` - Cannot be undone

=== Composition Rules (`composition-rules`)

==== Purpose

Defines how operations combine and what properties compose.

==== Structure

[source,scheme]
----
(define composition-rules
  '((sequential
     (description . "Execute operations in order")
     (entropy-behavior . "sum")
     (claim-propagation . "weakest")
     (failure-behavior . "abort-remaining"))

    (parallel
     (description . "Execute operations concurrently")
     (entropy-behavior . "max-plus-overhead")
     (claim-propagation . "weakest")
     (failure-behavior . "cancel-all"))

    (conditional
     (description . "Execute based on predicate result")
     (entropy-behavior . "branch-taken")
     (claim-propagation . "branch-specific")
     (failure-behavior . "branch-specific"))))
----

==== Composition Properties

Entropy Behavior::
  * `sum` - Add entropy contributions
  * `max-plus-overhead` - Maximum contribution plus overhead
  * `branch-taken` - Only entropy of executed branch

Claim Propagation::
  * `weakest` - Composed claim is weakest of components
  * `strongest` - Composed claim is strongest (requires justification)
  * `branch-specific` - Depends on which branch executes

=== Proof Obligations (`proof-obligations`)

==== Purpose

Defines verification interfaces for claims.

==== Structure

[source,scheme]
----
(define proof-obligations
  '((content-integrity
     (description . "Verify content has not been corrupted")
     (verification-method . "hash-comparison")
     (discharge-requirement . ("original-hash" "current-hash"))
     (failure-action . "downgrade-to-unverified"))

    (permission-held
     (description . "Verify required permission is held")
     (verification-method . "capability-check")
     (discharge-requirement . ("capability-token"))
     (failure-action . "abort-operation"))

    (invariant-preserved
     (description . "Verify system invariant is maintained")
     (verification-method . "predicate-evaluation")
     (discharge-requirement . ("invariant-expression" "current-state"))
     (failure-action . "rollback-if-compensable"))))
----

==== Failure Actions

* `downgrade-to-unverified` - Claim becomes unverified
* `abort-operation` - Operation does not proceed
* `rollback-if-compensable` - Attempt rollback if possible

=== Type System (`type-system`)

==== Purpose

Defines semantic types for operations and data.

==== Structure

[source,scheme]
----
(define type-system
  '((base-types
     ((type "bytes") (description . "Raw byte sequence"))
     ((type "text") (description . "UTF-8 text"))
     ((type "path") (description . "Filesystem path"))
     ((type "boolean") (description . "True or false"))
     ((type "claim") (description . "Verified/unverified/irreversible")))

    (operation-signatures
     ((operation "file-read")
      (input . "path")
      (output . "bytes")
      (may-fail . #t))
     ((operation "file-write")
      (input . ("path" "bytes"))
      (output . "boolean")
      (may-fail . #t)))))
----

== Execution Pipeline Position

NEUROSYM operates at step 3 in the pipeline:

[source]
----
1. META validation      ← Constitutional authority check
2. AGENTIC gating       ← Operational safety
3. NEUROSYM semantics   ← THIS SPECIFICATION
4. PLAYBOOK derivation  ← Build executable plan
5. Execution
6. ECOSYSTEM check
7. STATE update
----

=== Pipeline Rules

* NEUROSYM MUST define meaning for operations in PLAYBOOK
* NEUROSYM MUST be consulted before proof discharge
* NEUROSYM MUST be consulted before classifying action reversibility
* If proof obligations cannot be discharged, claims MUST be downgraded

== Proof Discharge

=== Discharge Protocol

When an operation claims a property:

1. Identify the proof obligation for that property
2. Collect required evidence (per `discharge-requirement`)
3. Execute verification method
4. If verification succeeds, claim is verified
5. If verification fails, execute failure action

=== Claim Downgrade

Failure to discharge a proof obligation MUST downgrade the claim:

[source]
----
verified → unverified (if verification fails)
unverified → unverified (no change)
compensable → irreversible (if compensation unavailable)
----

Claims MUST NOT be silently preserved at a higher level than proven.

== Security Considerations

=== Determinism

NEUROSYM semantics MUST be deterministic. Given the same inputs and state,
the same semantic evaluation MUST produce the same result.

=== Proof Obligations

All claimed properties MUST have associated proof obligations. Properties
without proof obligations MUST be treated as unverified.

=== Composition Safety

Composition rules MUST preserve or downgrade claim types, never upgrade them
without explicit proof.

== IANA Considerations

=== Media Type Registration

* **Type name**: application
* **Subtype name**: neurosym+scheme
* **Required parameters**: None
* **Optional parameters**: charset (default UTF-8), version
* **Encoding considerations**: UTF-8 text
* **Security considerations**: See Security Considerations section
* **Published specification**: This document

== Conformance

An implementation is NEUROSYM-conformant if:

* Operation definitions include all required fields
* Composition rules preserve claim-type safety
* Proof obligations are exposed for all claims
* Undischarged proofs result in claim downgrade
* Semantics are deterministic and unambiguous
