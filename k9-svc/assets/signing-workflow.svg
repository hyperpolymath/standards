<?xml version="1.0" encoding="UTF-8"?>
<!-- SPDX-License-Identifier: AGPL-3.0-or-later -->
<!-- signing-workflow.svg - K9 Ed25519 Signing Workflow -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500">
  <defs>
    <linearGradient id="keyGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#9c27b0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#6a1b9a;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="signGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2196f3;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1565c0;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="verifyGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4caf50;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2e7d32;stop-opacity:1" />
    </linearGradient>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#888888"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="800" height="500" fill="#1a1a2e"/>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" fill="#ffffff" font-family="system-ui, sans-serif" font-size="22" font-weight="bold">K9 Ed25519 Signing Workflow</text>

  <!-- Section 1: Key Generation -->
  <g transform="translate(30, 60)">
    <rect width="220" height="150" rx="10" fill="url(#keyGrad)" opacity="0.3" stroke="#ce93d8" stroke-width="2"/>
    <rect width="220" height="35" rx="10" ry="0" fill="url(#keyGrad)"/>
    <text x="110" y="24" text-anchor="middle" fill="#ffffff" font-family="system-ui, sans-serif" font-size="14" font-weight="bold">1. Key Generation</text>

    <text x="15" y="55" fill="#e1bee7" font-family="monospace" font-size="11">./sign.sh keygen alice</text>

    <text x="15" y="85" fill="#888888" font-family="system-ui, sans-serif" font-size="10">Creates:</text>
    <text x="25" y="102" fill="#ce93d8" font-family="monospace" font-size="10">~/.config/k9/keys/alice.key</text>
    <text x="25" y="117" fill="#888888" font-family="system-ui, sans-serif" font-size="9">(private - keep secret!)</text>
    <text x="25" y="135" fill="#ce93d8" font-family="monospace" font-size="10">~/.config/k9/keys/alice.pub</text>
    <text x="25" y="150" fill="#888888" font-family="system-ui, sans-serif" font-size="9">(public - share this)</text>
  </g>

  <!-- Section 2: Signing -->
  <g transform="translate(290, 60)">
    <rect width="220" height="150" rx="10" fill="url(#signGrad)" opacity="0.3" stroke="#90caf9" stroke-width="2"/>
    <rect width="220" height="35" rx="10" ry="0" fill="url(#signGrad)"/>
    <text x="110" y="24" text-anchor="middle" fill="#ffffff" font-family="system-ui, sans-serif" font-size="14" font-weight="bold">2. Sign Component</text>

    <text x="15" y="55" fill="#bbdefb" font-family="monospace" font-size="11">./sign.sh sign deploy.k9.ncl alice</text>

    <text x="15" y="85" fill="#888888" font-family="system-ui, sans-serif" font-size="10">Creates:</text>
    <text x="25" y="102" fill="#90caf9" font-family="monospace" font-size="10">deploy.k9.ncl.sig</text>
    <text x="25" y="117" fill="#888888" font-family="system-ui, sans-serif" font-size="9">(Base64-encoded Ed25519 signature)</text>

    <text x="15" y="140" fill="#888888" font-family="system-ui, sans-serif" font-size="10">Embed in pedigree:</text>
    <text x="25" y="155" fill="#90caf9" font-family="monospace" font-size="9">signature = "Uh7pu..."</text>
  </g>

  <!-- Section 3: Trust -->
  <g transform="translate(550, 60)">
    <rect width="220" height="150" rx="10" fill="#455a64" opacity="0.5" stroke="#90a4ae" stroke-width="2"/>
    <rect width="220" height="35" rx="10" ry="0" fill="#455a64"/>
    <text x="110" y="24" text-anchor="middle" fill="#ffffff" font-family="system-ui, sans-serif" font-size="14" font-weight="bold">3. Trust Key (Recipient)</text>

    <text x="15" y="55" fill="#cfd8dc" font-family="monospace" font-size="11">./sign.sh trust alice.pub</text>

    <text x="15" y="85" fill="#888888" font-family="system-ui, sans-serif" font-size="10">Copies to:</text>
    <text x="25" y="102" fill="#90a4ae" font-family="monospace" font-size="10">~/.config/k9/keys/trusted/</text>
    <text x="25" y="117" fill="#888888" font-family="system-ui, sans-serif" font-size="9">alice.pub</text>

    <text x="15" y="140" fill="#888888" font-family="system-ui, sans-serif" font-size="10">List trusted:</text>
    <text x="25" y="155" fill="#90a4ae" font-family="monospace" font-size="11">./sign.sh list</text>
  </g>

  <!-- Section 4: Verification -->
  <g transform="translate(30, 240)">
    <rect width="350" height="130" rx="10" fill="url(#verifyGrad)" opacity="0.3" stroke="#a5d6a7" stroke-width="2"/>
    <rect width="350" height="35" rx="10" ry="0" fill="url(#verifyGrad)"/>
    <text x="175" y="24" text-anchor="middle" fill="#ffffff" font-family="system-ui, sans-serif" font-size="14" font-weight="bold">4. Verify Component</text>

    <text x="15" y="55" fill="#c8e6c9" font-family="monospace" font-size="11">./sign.sh verify deploy.k9.ncl</text>

    <text x="15" y="85" fill="#888888" font-family="system-ui, sans-serif" font-size="10">Process:</text>
    <text x="25" y="102" fill="#a5d6a7" font-family="system-ui, sans-serif" font-size="10">1. Find .sig file or embedded signature</text>
    <text x="25" y="117" fill="#a5d6a7" font-family="system-ui, sans-serif" font-size="10">2. Try each trusted public key</text>
    <text x="25" y="132" fill="#a5d6a7" font-family="system-ui, sans-serif" font-size="10">3. OpenSSL Ed25519 verify</text>
    <text x="25" y="147" fill="#4caf50" font-family="system-ui, sans-serif" font-size="10" font-weight="bold">4. Report: VALID (key: alice) or INVALID</text>
  </g>

  <!-- Section 5: Authorization -->
  <g transform="translate(420, 240)">
    <rect width="350" height="130" rx="10" fill="#f44336" opacity="0.2" stroke="#ef9a9a" stroke-width="2"/>
    <rect width="350" height="35" rx="10" ry="0" fill="#c62828"/>
    <text x="175" y="24" text-anchor="middle" fill="#ffffff" font-family="system-ui, sans-serif" font-size="14" font-weight="bold">5. Hunt Authorization</text>

    <text x="15" y="55" fill="#ffcdd2" font-family="monospace" font-size="11">./sign.sh authorize deploy.k9.ncl</text>

    <text x="15" y="85" fill="#888888" font-family="system-ui, sans-serif" font-size="10">Full check:</text>
    <text x="25" y="102" fill="#ef9a9a" font-family="system-ui, sans-serif" font-size="10">1. Verify trust_level = 'Hunt in pedigree</text>
    <text x="25" y="117" fill="#ef9a9a" font-family="system-ui, sans-serif" font-size="10">2. Verify cryptographic signature</text>
    <text x="25" y="132" fill="#ef9a9a" font-family="system-ui, sans-serif" font-size="10">3. Check hunt_authorized = true</text>
    <text x="25" y="147" fill="#4caf50" font-family="system-ui, sans-serif" font-size="10" font-weight="bold">4. AUTHORIZED - safe to execute recipes</text>
  </g>

  <!-- Flow arrows -->
  <path d="M260 135 L280 135" stroke="#888888" stroke-width="2" marker-end="url(#arrow)"/>
  <path d="M520 135 L540 135" stroke="#888888" stroke-width="2" marker-end="url(#arrow)"/>
  <path d="M660 220 L660 230" stroke="#888888" stroke-width="2" marker-end="url(#arrow)"/>
  <path d="M205 220 L205 230" stroke="#888888" stroke-width="2" marker-end="url(#arrow)"/>
  <path d="M390 305 L410 305" stroke="#888888" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Cryptography note -->
  <rect x="30" y="395" width="740" height="80" rx="10" fill="#252540"/>
  <text x="50" y="420" fill="#ffffff" font-family="system-ui, sans-serif" font-size="12" font-weight="bold">Cryptographic Details</text>
  <text x="50" y="440" fill="#888888" font-family="system-ui, sans-serif" font-size="11">Algorithm: Ed25519 (Curve25519 + SHA-512) via OpenSSL</text>
  <text x="50" y="455" fill="#888888" font-family="system-ui, sans-serif" font-size="11">Key format: PEM (PKCS#8 private, SubjectPublicKeyInfo public)</text>
  <text x="50" y="470" fill="#888888" font-family="system-ui, sans-serif" font-size="11">Signature: Base64-encoded raw signature in .sig file or embedded in pedigree</text>
</svg>
