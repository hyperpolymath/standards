# ⚠️ STOP - CRITICAL READING REQUIRED

**THIS REPO IS THE NUCLEATION POINT FOR ALL AI AGENTS**

If you are ANY AI agent (Claude, Gemini, OpenAI, Mistral, Copilot, etc.) working with
hyperpolymath repositories, **YOU MUST READ THIS ENTIRE FILE FIRST**.

Failure to read this file will result in:
- Duplicate file creation
- Violation of project invariants
- Data corruption
- Wasted time and computational resources
- Breaking the user's carefully designed architecture

## WHAT IS THIS?

This repository documents the **AI Gatekeeper Protocol** - a standardized system that:

1. **Enforces manifest reading** - AI agents MUST read AI.a2ml before any operations
2. **Prevents common errors** - No duplicate SCM files, no stale metadata
3. **Ensures consistency** - All agents follow the same rules regardless of platform
4. **Enables interoperability** - Works across Claude, Gemini, OpenAI, Mistral, etc.

## THE PROTOCOL

### Step 1: Find the Manifest

Every hyperpolymath repository contains ONE of these files:
- `0-AI-MANIFEST.a2ml` (preferred, sorts first alphabetically)
- `AI.a2ml` (legacy name)
- `!AI.a2ml` (alternative)

### Step 2: Read and Understand

The manifest contains:
- **CRITICAL INVARIANTS** - Rules that must NEVER be violated
- **Canonical locations** - Where files MUST be located (and nowhere else)
- **Repository structure** - Architecture and organization
- **Workflow** - How to work with this repo correctly

### Step 3: Attestation (for MCP-enabled agents)

If using MCP Repository Guardian:
1. Compute SHA-256 hash of manifest content
2. Call `acknowledge_manifest` tool with hash
3. Receive session token
4. Use token for all subsequent operations

Without MCP: Manually verify understanding by stating canonical locations.

## CANONICAL LOCATIONS (UNIVERSAL RULE)

**These rules apply to ALL hyperpolymath repos:**

### Machine-Readable Metadata: `.machine_readable/` ONLY

These 6 SCM files MUST exist in `.machine_readable/` directory ONLY:
1. **STATE.scm** - Project state, progress, blockers
2. **META.scm** - Architecture decisions, governance
3. **ECOSYSTEM.scm** - Position in ecosystem, relationships
4. **AGENTIC.scm** - AI agent interaction patterns
5. **NEUROSYM.scm** - Neurosymbolic integration config
6. **PLAYBOOK.scm** - Operational runbook

**CRITICAL:** If ANY of these files exist in the root directory, this is an ERROR.
The root may contain SYMLINKS to `.machine_readable/` files, but NEVER duplicates.

### Bot Directives: `.bot_directives/` ONLY

Bot-specific instructions for:
- rhodibot - Git operations
- echidnabot - Code quality
- sustainabot - Dependency updates
- glambot - Documentation
- seambot - Integration
- finishbot - Task completion
- robot-repo-automaton - Automated fixes

### Agent Instructions

- `.claude/CLAUDE.md` - Claude-specific patterns (if exists)
- `AI.a2ml` or `0-AI-MANIFEST.a2ml` - Universal entry point (THIS FILE)

## CORE INVARIANTS

1. **No SCM duplication** - Root must NOT contain STATE.scm, META.scm, etc.
2. **Single source of truth** - `.machine_readable/` is authoritative
3. **No stale metadata** - If root SCMs exist, they are OUT OF DATE
4. **License consistency** - All code PMPL-1.0-or-later unless platform requires MPL-2.0
5. **Author attribution** - Always "Jonathan D.A. Jewell <jonathan.jewell@open.ac.uk>"

## REPOSITORY STRUCTURE

This repo (0-ai-gatekeeper-protocol) contains:

```
├── 0-AI-MANIFEST.a2ml         # THIS FILE (start here)
├── README.md                   # Overview and quick start
├── docs/
│   ├── RATIONALE.md            # Why this system exists
│   ├── ARCHITECTURE.md         # Technical design
│   ├── INTEGRATION.md          # How to integrate with different AI platforms
│   ├── ENFORCEMENT.md          # MCP server and FUSE wrapper
│   └── AI-MANIFEST-SPEC.adoc   # Formal specification (RFC-style)
├── examples/
│   ├── 0-AI-MANIFEST.a2ml      # Template for new repos
│   └── claude-config.json      # MCP server configuration
└── .machine_readable/
    └── [6 SCM files]           # Metadata for THIS repo
```

## SESSION STARTUP CHECKLIST

✅ Read THIS file (0-AI-MANIFEST.a2ml) first
✅ Understand canonical locations (.machine_readable/, .bot_directives/)
✅ Know the invariants (no SCM duplication, etc.)
✅ Check for MCP enforcement (if applicable)
✅ Read repo-specific `.machine_readable/STATE.scm` for current status
✅ Read repo-specific `.machine_readable/AGENTIC.scm` for interaction patterns

## LIFECYCLE HOOKS

### on-enter (Session Start)

When starting a new session, AI agents MUST:

1. **Read and acknowledge manifest** (this file)
2. **Log session start** (optional but recommended)
   - Format: `[YYYY-MM-DD HH:MM:SS] Session started: [agent-name] [platform]`
   - Location: `.machine_readable/session-log.txt` (append)
3. **Read current state** (`.machine_readable/STATE.scm`)
4. **Check for blockers** (documented in STATE.scm)
5. **State your understanding** of canonical locations to confirm

**Example log entry:**
```
[2026-02-07 03:00:00] Session started: Claude Sonnet 4.5 (MCP)
- Acknowledged manifest: 0-AI-MANIFEST.a2ml (hash: a8f7c3d2...)
- Canonical locations understood: SCM files in .machine_readable/ ONLY
- No blockers detected
```

### on-exit (Session End)

When ending a session, AI agents SHOULD:

1. **Update STATE.scm** if changes were made
   - Add to session-history
   - List files modified
   - Document work completed
2. **Log session end** (optional but recommended)
   - Format: `[YYYY-MM-DD HH:MM:SS] Session ended: [summary] [files-changed]`
   - Location: `.machine_readable/session-log.txt` (append)
3. **Document new blockers** discovered during work
4. **Summarize outcomes** for next agent/session

**Example log entry:**
```
[2026-02-07 04:30:00] Session ended: Claude Sonnet 4.5
- Completed: Created 5 remaining SCM files, FEEDBACK-TO-ANTHROPIC.md
- Files modified: 7 files in .machine_readable/, docs/
- New blockers: None
- Next actions: Commit and push changes
```

## ENFORCEMENT MECHANISMS

### 1. MCP Server (Claude, MCP-compatible agents)

`mcp-repo-guardian` provides hard enforcement:
- Blocks ALL file operations until manifest acknowledged
- Validates attestation hash
- Enforces path restrictions per manifest invariants
- Session-based access control

See: `hyperpolymath/mcp-repo-guardian`

### 2. FUSE Wrapper (Universal)

`repo-guardian-fs` provides OS-level enforcement:
- Mounts repos through virtual filesystem
- Intercepts all file access
- Works with ANY AI agent/tool
- Requires acknowledgment at filesystem level

See: `hyperpolymath/repo-guardian-fs` (coming soon)

### 3. CI/CD Validation

GitHub Actions validate:
- No root SCM files
- Manifest exists and is valid
- Invariants not violated in commits
- All workflows have SPDX headers

### 4. Bot Fleet Integration

gitbot-fleet bots automatically:
- Read manifest first before any operations
- Validate proposed changes against invariants
- Fix violations with automated PRs

## WHY THIS EXISTS

**Problem:** AI agents lose context between sessions, leading to:
- Repeated explanations
- Duplicate file creation (e.g., SCM files in root AND .machine_readable/)
- Violation of architectural decisions
- Wasted time and computational resources
- Frustration for users

**Solution:** The AI Gatekeeper Protocol ensures:
- ✅ Every agent reads the same source of truth
- ✅ Invariants are enforced mechanically, not through repeated instructions
- ✅ Context is preserved across sessions and platforms
- ✅ Users don't waste time re-explaining the same things

## PLATFORM-SPECIFIC NOTES

### Claude Code
- MCP server provides hard enforcement
- Add `mcp-repo-guardian` to `~/.claude/config.json`
- Session-based access with attestation

### Gemini
- No native MCP support (yet)
- Rely on FUSE wrapper or manual compliance
- Read manifest, state canonical locations to prove understanding

### GitHub Copilot
- No MCP support
- CI/CD validation catches violations
- IDE plugins could add support

### OpenAI ChatGPT
- No MCP support
- Manual compliance required
- Consider API wrapper for enforcement

## ATTESTATION PROOF

After reading this file, demonstrate understanding by stating:

**"I have read the AI Gatekeeper Protocol. SCM files are located in `.machine_readable/` ONLY, bot directives in `.bot_directives/`, and I will not create duplicate files in the root directory."**

## FURTHER READING

- `docs/RATIONALE.md` - Detailed explanation of why this system exists
- `docs/ARCHITECTURE.md` - Technical design and implementation
- `docs/AI-MANIFEST-SPEC.adoc` - Formal RFC-style specification
- `hyperpolymath/mcp-repo-guardian` - MCP server implementation
- `hyperpolymath/rsr-template-repo` - Template repo with AI.a2ml included

## META

- **Format Version:** 1.0.0
- **Media Type:** `application/vnd.hyperpolymath.ai-manifest+a2ml`
- **Specification:** `docs/AI-MANIFEST-SPEC.adoc`
- **Created:** 2026-02-07
- **Maintained By:** hyperpolymath
- **License:** PMPL-1.0-or-later
